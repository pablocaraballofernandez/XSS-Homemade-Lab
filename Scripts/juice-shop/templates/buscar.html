{% extends "base.html" %}

{% block title %}Buscar{% endblock %}

{% block content %}
<section class="section page-search">
    <div class="container">
        <div class="section-header">
            <span class="section-tag">Explorar</span>
            <h2>Buscar Zumos</h2>
        </div>

        <!-- Formulario de b√∫squeda -->
        <form class="search-form" action="{{ url_for('buscar') }}" method="GET">
            <div class="search-input-group">
                <input type="text" name="q" value="{{ query_raw }}" placeholder="¬øQu√© zumo buscas? (naranja, mango, detox...)" autofocus>
                <button type="submit" class="btn btn-primary">Buscar üîç</button>
            </div>
        </form>

        {% if query_raw %}
        <!-- ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó -->
        <!-- ‚ïë  üî¥ XSS REFLEJADA AQU√ç                                      ‚ïë -->
        <!-- ‚ïë  El filtro |safe desactiva el auto-escape de Jinja2          ‚ïë -->
        <!-- ‚ïë  Permite inyectar HTML/JS mediante el par√°metro 'q'          ‚ïë -->
        <!-- ‚ïë  Ejemplo: /buscar?q=<script>alert('XSS')</script>            ‚ïë -->
        <!-- ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù -->
        <div class="search-results-header">
            <p>Resultados para: <strong>{{ query_raw|safe }}</strong></p>
            <span class="results-count">{{ resultados|length }} zumo(s) encontrado(s)</span>
        </div>

        {% if resultados %}
        <div class="product-grid">
            {% for producto in resultados %}
            <article class="product-card">
                <div class="product-image">
                    <div class="product-emoji">
                        {% if 'naranja' in producto.nombre|lower %}üçä
                        {% elif 'tropical' in producto.nombre|lower or 'mango' in producto.nombre|lower %}ü•≠
                        {% elif 'verde' in producto.nombre|lower or 'detox' in producto.nombre|lower %}ü•¨
                        {% elif 'fresa' in producto.nombre|lower %}üçì
                        {% elif 'aca√≠' in producto.nombre|lower or 'a√ßa√≠' in producto.nombre|lower %}ü´ê
                        {% elif 'sand√≠a' in producto.nombre|lower %}üçâ
                        {% elif 'zanahoria' in producto.nombre|lower %}ü•ï
                        {% elif 'remolacha' in producto.nombre|lower %}ü´í
                        {% elif 'coco' in producto.nombre|lower %}ü••
                        {% else %}üßÉ{% endif %}
                    </div>
                    <span class="product-category">{{ producto.categoria }}</span>
                </div>
                <div class="product-info">
                    <h3>{{ producto.nombre }}</h3>
                    <p>{{ producto.descripcion }}</p>
                    <div class="product-footer">
                        <span class="product-price">{{ "%.2f"|format(producto.precio) }}‚Ç¨</span>
                        <a href="{{ url_for('producto_detalle', producto_id=producto.id) }}" class="btn btn-small">Ver m√°s</a>
                    </div>
                </div>
            </article>
            {% endfor %}
        </div>
        {% else %}
        <div class="empty-state">
            <div class="empty-icon">üîç</div>
            <!-- üî¥ TAMBI√âN VULNERABLE: query_raw|safe sin escapar -->
            <h3>No encontramos zumos con "{{ query_raw|safe }}"</h3>
            <p>Prueba con otro t√©rmino o explora nuestras categor√≠as</p>
            <a href="{{ url_for('productos') }}" class="btn btn-primary">Ver todos los zumos</a>
        </div>
        {% endif %}

        {% else %}
        <div class="empty-state">
            <div class="empty-icon">üçπ</div>
            <h3>Busca tu zumo favorito</h3>
            <p>Escribe el nombre, ingrediente o categor√≠a que te interese</p>
        </div>
        {% endif %}
    </div>
</section>
{% endblock %}
